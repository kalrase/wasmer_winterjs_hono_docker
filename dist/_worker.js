var Be=Object.defineProperty;var Le=(e,t,r)=>t in e?Be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var u=(e,t,r)=>(Le(e,typeof t!="symbol"?t+"":t,r),r),ue=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var f=(e,t,r)=>(ue(e,t,"read from private field"),r?r.call(e):t.get(e)),O=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},p=(e,t,r,s)=>(ue(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r);var Me={Stringify:1,BeforeStream:2,Stream:3},M=(e,t)=>{const r=new String(e);return r.isEscaped=!0,r.callbacks=t,r},ke=/[&<>'"]/,be=async e=>{let t="";const r=[];for(let s=e.length-1;t+=e[s],s--,!(s<0);s--){let n=await e[s];typeof n=="object"&&r.push(...n.callbacks||[]);const i=n.isEscaped;if(n=await(typeof n=="object"?n.toString():n),typeof n=="object"&&r.push(...n.callbacks||[]),n.isEscaped??i)t+=n;else{const a=[t];_(n,a),t=a[0]}}return M(t,r)},_=(e,t)=>{const r=e.search(ke);if(r===-1){t[0]+=e;return}let s,n,i=0;for(n=r;n<e.length;n++){switch(e.charCodeAt(n)){case 34:s="&quot;";break;case 39:s="&#39;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}t[0]+=e.substring(i,n)+s,i=n+1}t[0]+=e.substring(i,n)},xe=async(e,t,r,s,n)=>{const i=e.callbacks;return i!=null&&i.length?(n?n[0]+=e:n=[e],Promise.all(i.map(c=>c({phase:t,buffer:n,context:s}))).then(c=>Promise.all(c.filter(Boolean).map(o=>xe(o,t,!1,s,n))).then(()=>n[0]))):Promise.resolve(e)},ze=(e,...t)=>{const r=[""];for(let s=0,n=e.length-1;s<n;s++){r[0]+=e[s];const i=t[s]instanceof Array?t[s].flat(1/0):[t[s]];for(let a=0,c=i.length;a<c;a++){const o=i[a];if(typeof o=="string")_(o,r);else if(typeof o=="number")r[0]+=o;else{if(typeof o=="boolean"||o===null||o===void 0)continue;if(typeof o=="object"&&o.isEscaped)if(o.callbacks)r.unshift("",o);else{const l=o.toString();l instanceof Promise?r.unshift("",l):r[0]+=l}else o instanceof Promise?r.unshift("",o):_(o.toString(),r)}}}return r[0]+=e[e.length-1],r.length===1?M(r[0]):be(r)},qe=Symbol("RENDERER"),Ue=Symbol("ERROR_HANDLER"),We=Symbol("INTERNAL"),te=e=>(e[We]=!0,e),Ve={type:{get(){return this.tag}},ref:{get(){var e;return(e=this.props)==null?void 0:e.ref}}},Ke=e=>Object.defineProperties(e,Ve),Je=(e,t,r)=>Ke({tag:e,props:t,key:r}),Xe=e=>Je("",e,void 0),Ge=e=>te(({value:t,children:r})=>{if(!r)return;const s={children:[{tag:te(()=>{e.push(t)}),props:{}}]};Array.isArray(r)?s.children.push(...r.flat()):s.children.push(r),s.children.push({tag:te(()=>{e.pop()}),props:{}});const n=Xe(s);return n[Ue]=i=>{throw e.pop(),i},n}),ie=[],Ze=e=>{const t=[e],r={values:t,Provider(s){t.push(s.value);let n;try{n=s.children?(Array.isArray(s.children)?new Ee("",{},s.children):s.children).toString():""}finally{t.pop()}return n instanceof Promise?n.then(i=>M(i,i.callbacks)):M(n)}};return r.Provider[qe]=Ge(t),ie.push(r),r},Qe=new Map([["className","class"],["htmlFor","for"]]),Ye=e=>Qe.get(e)||e,et=(e,t)=>{for(const[r,s]of Object.entries(e)){const n=r[0]==="-"||!/[A-Z]/.test(r)?r:r.replace(/[A-Z]/g,i=>`-${i.toLowerCase()}`);t(n,s==null?null:typeof s=="number"?n.match(/^(?:a|border-im|column(?:-c|s)|flex(?:$|-[^b])|grid-(?:ar|[^a])|font-w|li|or|sca|st|ta|wido|z)|ty$/)?`${s}`:`${s}px`:s)}},tt=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],rt=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],ce=(e,t)=>{for(let r=0,s=e.length;r<s;r++){const n=e[r];if(typeof n=="string")_(n,t);else{if(typeof n=="boolean"||n===null||n===void 0)continue;n instanceof B?n.toStringToBuffer(t):typeof n=="number"||n.isEscaped?t[0]+=n:n instanceof Promise?t.unshift("",n):ce(n,t)}}},B=class{constructor(e,t,r){u(this,"tag");u(this,"props");u(this,"key");u(this,"children");u(this,"isEscaped",!0);u(this,"localContexts");this.tag=e,this.props=t,this.children=r}get type(){return this.tag}get ref(){return this.props.ref||null}toString(){var t,r;const e=[""];(t=this.localContexts)==null||t.forEach(([s,n])=>{s.values.push(n)});try{this.toStringToBuffer(e)}finally{(r=this.localContexts)==null||r.forEach(([s])=>{s.values.pop()})}return e.length===1?e[0]:be(e)}toStringToBuffer(e){const t=this.tag,r=this.props;let{children:s}=this;e[0]+=`<${t}`;for(let[n,i]of Object.entries(r))if(n=Ye(n),n!=="children"){if(n==="style"&&typeof i=="object"){let a="";et(i,(c,o)=>{o!=null&&(a+=`${a?";":""}${c}:${o}`)}),e[0]+=' style="',_(a,e),e[0]+='"'}else if(typeof i=="string")e[0]+=` ${n}="`,_(i,e),e[0]+='"';else if(i!=null)if(typeof i=="number"||i.isEscaped)e[0]+=` ${n}="${i}"`;else if(typeof i=="boolean"&&rt.includes(n))i&&(e[0]+=` ${n}=""`);else if(n==="dangerouslySetInnerHTML"){if(s.length>0)throw"Can only set one of `children` or `props.dangerouslySetInnerHTML`.";s=[M(i.__html)]}else if(i instanceof Promise)e[0]+=` ${n}="`,e.unshift('"',i);else if(typeof i=="function"){if(!n.startsWith("on"))throw`Invalid prop '${n}' of type 'function' supplied to '${t}'.`}else e[0]+=` ${n}="`,_(i.toString(),e),e[0]+='"'}if(tt.includes(t)&&s.length===0){e[0]+="/>";return}e[0]+=">",ce(s,e),e[0]+=`</${t}>`}},st=class extends B{toStringToBuffer(e){const{children:t}=this,r=this.tag.call(null,{...this.props,children:t.length<=1?t[0]:t});if(r instanceof Promise)if(ie.length===0)e.unshift("",r);else{const s=ie.map(n=>[n,n.values.at(-1)]);e.unshift("",r.then(n=>(n instanceof B&&(n.localContexts=s),n)))}else r instanceof B?r.toStringToBuffer(e):typeof r=="number"||r.isEscaped?e[0]+=r:_(r,e)}},Ee=class extends B{toStringToBuffer(e){ce(this.children,e)}},fe=(e,t,...r)=>{t??(t={}),r.length&&(t.children=r.length===1?r[0]:r);const s=t.key;delete t.key;const n=X(e,t,r);return n.key=s,n},X=(e,t,r)=>typeof e=="function"?new st(e,t,r):new B(e,t,r),nt=({children:e})=>new Ee("",{children:e},Array.isArray(e)?e:e?[e]:[]);function N(e,t,r){let s;if(!t||!("children"in t))s=X(e,t,[]);else{const n=t.children;s=Array.isArray(n)?X(e,t,n):X(e,t,[n])}return s.key=r,s}var it="text/plain; charset=UTF-8",re=(e,t={})=>(Object.entries(t).forEach(([r,s])=>e.set(r,s)),e),H,A,g,y,E,P,ye,G=(ye=class{constructor(e,t){u(this,"req");u(this,"env",{});u(this,"_var");u(this,"finalized",!1);u(this,"error");O(this,H,200);O(this,A,void 0);O(this,g,void 0);O(this,y,void 0);O(this,E,void 0);O(this,P,!0);u(this,"layout");u(this,"renderer",e=>this.html(e));u(this,"notFoundHandler",()=>new Response);u(this,"render",(...e)=>this.renderer(...e));u(this,"setLayout",e=>this.layout=e);u(this,"getLayout",()=>this.layout);u(this,"setRenderer",e=>{this.renderer=e});u(this,"header",(e,t,r)=>{if(t===void 0){f(this,g)?f(this,g).delete(e):f(this,y)&&delete f(this,y)[e.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(e);return}r!=null&&r.append?(f(this,g)||(p(this,P,!1),p(this,g,new Headers(f(this,y))),p(this,y,{})),f(this,g).append(e,t)):f(this,g)?f(this,g).set(e,t):(f(this,y)??p(this,y,{}),f(this,y)[e.toLowerCase()]=t),this.finalized&&(r!=null&&r.append?this.res.headers.append(e,t):this.res.headers.set(e,t))});u(this,"status",e=>{p(this,P,!1),p(this,H,e)});u(this,"set",(e,t)=>{this._var??(this._var={}),this._var[e]=t});u(this,"get",e=>this._var?this._var[e]:void 0);u(this,"newResponse",(e,t,r)=>{if(f(this,P)&&!r&&!t&&f(this,H)===200)return new Response(e,{headers:f(this,y)});if(t&&typeof t!="number"){const n=new Headers(t.headers);f(this,g)&&f(this,g).forEach((a,c)=>{c==="set-cookie"?n.append(c,a):n.set(c,a)});const i=re(n,f(this,y));return new Response(e,{headers:i,status:t.status??f(this,H)})}const s=typeof t=="number"?t:f(this,H);f(this,y)??p(this,y,{}),f(this,g)??p(this,g,new Headers),re(f(this,g),f(this,y)),f(this,E)&&(f(this,E).headers.forEach((n,i)=>{var a,c;i==="set-cookie"?(a=f(this,g))==null||a.append(i,n):(c=f(this,g))==null||c.set(i,n)}),re(f(this,g),f(this,y))),r??(r={});for(const[n,i]of Object.entries(r))if(typeof i=="string")f(this,g).set(n,i);else{f(this,g).delete(n);for(const a of i)f(this,g).append(n,a)}return new Response(e,{status:s,headers:f(this,g)})});u(this,"body",(e,t,r)=>typeof t=="number"?this.newResponse(e,t,r):this.newResponse(e,t));u(this,"text",(e,t,r)=>{if(!f(this,y)){if(f(this,P)&&!r&&!t)return new Response(e);p(this,y,{})}return f(this,y)["content-type"]=it,typeof t=="number"?this.newResponse(e,t,r):this.newResponse(e,t)});u(this,"json",(e,t,r)=>{const s=JSON.stringify(e);return f(this,y)??p(this,y,{}),f(this,y)["content-type"]="application/json; charset=UTF-8",typeof t=="number"?this.newResponse(s,t,r):this.newResponse(s,t)});u(this,"html",(e,t,r)=>(f(this,y)??p(this,y,{}),f(this,y)["content-type"]="text/html; charset=UTF-8",typeof e=="object"&&(e instanceof Promise||(e=e.toString()),e instanceof Promise)?e.then(s=>xe(s,Me.Stringify,!1,{})).then(s=>typeof t=="number"?this.newResponse(s,t,r):this.newResponse(s,t)):typeof t=="number"?this.newResponse(e,t,r):this.newResponse(e,t)));u(this,"redirect",(e,t)=>(f(this,g)??p(this,g,new Headers),f(this,g).set("Location",e),this.newResponse(null,t??302)));u(this,"notFound",()=>this.notFoundHandler(this));this.req=e,t&&(p(this,A,t.executionCtx),this.env=t.env,t.notFoundHandler&&(this.notFoundHandler=t.notFoundHandler))}get event(){if(f(this,A)&&"respondWith"in f(this,A))return f(this,A);throw Error("This context has no FetchEvent")}get executionCtx(){if(f(this,A))return f(this,A);throw Error("This context has no ExecutionContext")}get res(){return p(this,P,!1),f(this,E)||p(this,E,new Response("404 Not Found",{status:404}))}set res(e){if(p(this,P,!1),f(this,E)&&e){f(this,E).headers.delete("content-type");for(const[t,r]of f(this,E).headers.entries())if(t==="set-cookie"){const s=f(this,E).headers.getSetCookie();e.headers.delete("set-cookie");for(const n of s)e.headers.append("set-cookie",n)}else e.headers.set(t,r)}p(this,E,e),this.finalized=!0}get var(){return{...this._var}}},H=new WeakMap,A=new WeakMap,g=new WeakMap,y=new WeakMap,E=new WeakMap,P=new WeakMap,ye),de=(e,t,r)=>(s,n)=>{let i=-1;return a(0);async function a(c){if(c<=i)throw new Error("next() called multiple times");i=c;let o,l=!1,h;if(e[c]?(h=e[c][0][0],s instanceof G&&(s.req.routeIndex=c)):h=c===e.length&&n||void 0,!h)s instanceof G&&s.finalized===!1&&r&&(o=await r(s));else try{o=await h(s,()=>a(c+1))}catch(d){if(d instanceof Error&&s instanceof G&&t)s.error=d,o=await t(d,s),l=!0;else throw d}return o&&(s.finalized===!1||l)&&(s.res=o),s}},ot=async(e,t=Object.create(null))=>{const{all:r=!1,dot:s=!1}=t,i=(e instanceof Oe?e.raw.headers:e.headers).get("Content-Type");return i!==null&&i.startsWith("multipart/form-data")||i!==null&&i.startsWith("application/x-www-form-urlencoded")?at(e,{all:r,dot:s}):{}};async function at(e,t){const r=await e.formData();return r?ct(r,t):{}}function ct(e,t){const r=Object.create(null);return e.forEach((s,n)=>{t.all||n.endsWith("[]")?lt(r,n,s):r[n]=s}),t.dot&&Object.entries(r).forEach(([s,n])=>{s.includes(".")&&(ht(r,s,n),delete r[s])}),r}var lt=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:e[t]=r},ht=(e,t,r)=>{let s=e;const n=t.split(".");n.forEach((i,a)=>{a===n.length-1?s[i]=r:((!s[i]||typeof s[i]!="object"||Array.isArray(s[i])||s[i]instanceof File)&&(s[i]=Object.create(null)),s=s[i])})},Re=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},ut=e=>{const{groups:t,path:r}=ft(e),s=Re(r);return dt(s,t)},ft=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{const n=`@${s}`;return t.push([n,r]),n}),{groups:t,path:e}},dt=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},J={},pe=e=>{if(e==="*")return"*";const t=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);return t?(J[e]||(t[2]?J[e]=[e,t[1],new RegExp("^"+t[2]+"$")]:J[e]=[e,t[1],!0]),J[e]):null},pt=e=>{try{return decodeURI(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,t=>{try{return decodeURI(t)}catch{return t}})}},le=e=>{const t=e.url,r=t.indexOf("/",8);let s=r;for(;s<t.length;s++){const n=t.charCodeAt(s);if(n===37){const i=t.indexOf("?",s),a=t.slice(r,i===-1?void 0:i);return pt(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(n===63)break}return t.slice(r,s)},gt=e=>{const t=le(e);return t.length>1&&t[t.length-1]==="/"?t.slice(0,-1):t},z=(...e)=>{let t="",r=!1;for(let s of e)t[t.length-1]==="/"&&(t=t.slice(0,-1),r=!0),s[0]!=="/"&&(s=`/${s}`),s==="/"&&r?t=`${t}/`:s!=="/"&&(t=`${t}${s}`),s==="/"&&t===""&&(t="/");return t},Se=e=>{if(!e.match(/\:.+\?$/))return null;const t=e.split("/"),r=[];let s="";return t.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&s===""?r.push("/"):r.push(s);const i=n.replace("?","");s+="/"+i,r.push(s)}else s+="/"+n}),r.filter((n,i,a)=>a.indexOf(n)===i)},se=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),/%/.test(e)?oe(e):e):e,je=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let a=e.indexOf(`?${t}`,8);for(a===-1&&(a=e.indexOf(`&${t}`,8));a!==-1;){const c=e.charCodeAt(a+t.length+1);if(c===61){const o=a+t.length+2,l=e.indexOf("&",o);return se(e.slice(o,l===-1?void 0:l))}else if(c==38||isNaN(c))return"";a=e.indexOf(`&${t}`,a+1)}if(s=/[%+]/.test(e),!s)return}const n={};s??(s=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){const a=e.indexOf("&",i+1);let c=e.indexOf("=",i);c>a&&a!==-1&&(c=-1);let o=e.slice(i+1,c===-1?a===-1?void 0:a:c);if(s&&(o=se(o)),i=a,o==="")continue;let l;c===-1?l="":(l=e.slice(c+1,a===-1?void 0:a),s&&(l=se(l))),r?(n[o]&&Array.isArray(n[o])||(n[o]=[]),n[o].push(l)):n[o]??(n[o]=l)}return t?n[t]:n},mt=je,yt=(e,t)=>je(e,t,!0),oe=decodeURIComponent,L,R,ve,Oe=(ve=class{constructor(e,t="/",r=[[]]){u(this,"raw");O(this,L,void 0);O(this,R,void 0);u(this,"routeIndex",0);u(this,"path");u(this,"bodyCache",{});u(this,"cachedBody",e=>{const{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;const n=Object.keys(t)[0];return n?t[n].then(i=>(n==="json"&&(i=JSON.stringify(i)),new Response(i)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,p(this,R,r),p(this,L,{})}param(e){return e?this.getDecodedParam(e):this.getAllDecodedParams()}getDecodedParam(e){const t=f(this,R)[0][this.routeIndex][1][e],r=this.getParamValue(t);return r?/\%/.test(r)?oe(r):r:void 0}getAllDecodedParams(){const e={},t=Object.keys(f(this,R)[0][this.routeIndex][1]);for(const r of t){const s=this.getParamValue(f(this,R)[0][this.routeIndex][1][r]);s&&typeof s=="string"&&(e[r]=/\%/.test(s)?oe(s):s)}return e}getParamValue(e){return f(this,R)[1]?f(this,R)[1][e]:e}query(e){return mt(this.url,e)}queries(e){return yt(this.url,e)}header(e){if(e)return this.raw.headers.get(e.toLowerCase())??void 0;const t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await ot(this,e))}json(){return this.cachedBody("json")}text(){return this.cachedBody("text")}arrayBuffer(){return this.cachedBody("arrayBuffer")}blob(){return this.cachedBody("blob")}formData(){return this.cachedBody("formData")}addValidatedData(e,t){f(this,L)[e]=t}valid(e){return f(this,L)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return f(this,R)[0].map(([[,e]])=>e)}get routePath(){return f(this,R)[0].map(([[,e]])=>e)[this.routeIndex].path}},L=new WeakMap,R=new WeakMap,ve),w="ALL",vt="all",wt=["get","post","put","delete","options","patch"],$e="Can not add a route since the matcher is already built.",Te=class extends Error{},bt=Symbol("composedHandler"),xt=e=>e.text("404 Not Found",404),ge=(e,t)=>"getResponse"in e?e.getResponse():(console.error(e),t.text("Internal Server Error",500)),S,we,Ae=(we=class{constructor(t={}){u(this,"get");u(this,"post");u(this,"put");u(this,"delete");u(this,"options");u(this,"patch");u(this,"all");u(this,"on");u(this,"use");u(this,"router");u(this,"getPath");u(this,"_basePath","/");O(this,S,"/");u(this,"routes",[]);u(this,"notFoundHandler",xt);u(this,"errorHandler",ge);u(this,"onError",t=>(this.errorHandler=t,this));u(this,"notFound",t=>(this.notFoundHandler=t,this));u(this,"fetch",(t,...r)=>this.dispatch(t,r[1],r[0],t.method));u(this,"request",(t,r,s,n)=>{if(t instanceof Request)return r!==void 0&&(t=new Request(t,r)),this.fetch(t,s,n);t=t.toString();const i=/^https?:\/\//.test(t)?t:`http://localhost${z("/",t)}`,a=new Request(i,r);return this.fetch(a,s,n)});u(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(this.dispatch(t.request,t,void 0,t.request.method))})});[...wt,vt].forEach(n=>{this[n]=(i,...a)=>(typeof i=="string"?p(this,S,i):this.addRoute(n,f(this,S),i),a.forEach(c=>{typeof c!="string"&&this.addRoute(n,f(this,S),c)}),this)}),this.on=(n,i,...a)=>{for(const c of[i].flat()){p(this,S,c);for(const o of[n].flat())a.map(l=>{this.addRoute(o.toUpperCase(),f(this,S),l)})}return this},this.use=(n,...i)=>(typeof n=="string"?p(this,S,n):(p(this,S,"*"),i.unshift(n)),i.forEach(a=>{this.addRoute(w,f(this,S),a)}),this);const s=t.strict??!0;delete t.strict,Object.assign(this,t),this.getPath=s?t.getPath??le:gt}clone(){const t=new Ae({router:this.router,getPath:this.getPath});return t.routes=this.routes,t}route(t,r){const s=this.basePath(t);return r.routes.map(n=>{let i;r.errorHandler===ge?i=n.handler:(i=async(a,c)=>(await de([],r.errorHandler)(a,()=>n.handler(a,c))).res,i[bt]=n.handler),s.addRoute(n.method,n.path,i)}),this}basePath(t){const r=this.clone();return r._basePath=z(this._basePath,t),r}mount(t,r,s){let n,i;s&&(typeof s=="function"?i=s:(i=s.optionHandler,n=s.replaceRequest));const a=i?o=>{const l=i(o);return Array.isArray(l)?l:[l]}:o=>{let l;try{l=o.executionCtx}catch{}return[o.env,l]};n||(n=(()=>{const o=z(this._basePath,t),l=o==="/"?0:o.length;return h=>{const d=new URL(h.url);return d.pathname=d.pathname.slice(l)||"/",new Request(d,h)}})());const c=async(o,l)=>{const h=await r(n(o.req.raw),...a(o));if(h)return h;await l()};return this.addRoute(w,z(t,"*"),c),this}addRoute(t,r,s){t=t.toUpperCase(),r=z(this._basePath,r);const n={path:r,method:t,handler:s};this.router.add(t,r,[s,n]),this.routes.push(n)}matchRoute(t,r){return this.router.match(t,r)}handleError(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t}dispatch(t,r,s,n){if(n==="HEAD")return(async()=>new Response(null,await this.dispatch(t,r,s,"GET")))();const i=this.getPath(t,{env:s}),a=this.matchRoute(n,i),c=new G(new Oe(t,i,a),{env:s,executionCtx:r,notFoundHandler:this.notFoundHandler});if(a[0].length===1){let l;try{l=a[0][0][0][0](c,async()=>{c.res=await this.notFoundHandler(c)})}catch(h){return this.handleError(h,c)}return l instanceof Promise?l.then(h=>h||(c.finalized?c.res:this.notFoundHandler(c))).catch(h=>this.handleError(h,c)):l??this.notFoundHandler(c)}const o=de(a[0],this.errorHandler,this.notFoundHandler);return(async()=>{try{const l=await o(c);if(!l.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return l.res}catch(l){return this.handleError(l,c)}})()}},S=new WeakMap,we),Q="[^/]+",U=".*",W="(?:|/.*)",q=Symbol(),Et=new Set(".\\+*[^]$()");function Rt(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===U||e===W?1:t===U||t===W?-1:e===Q?1:t===Q?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var ae=class{constructor(){u(this,"index");u(this,"varIndex");u(this,"children",Object.create(null))}insert(t,r,s,n,i){if(t.length===0){if(this.index!==void 0)throw q;if(i)return;this.index=r;return}const[a,...c]=t,o=a==="*"?c.length===0?["","",U]:["","",Q]:a==="/*"?["","",W]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let l;if(o){const h=o[1];let d=o[2]||Q;if(h&&o[2]&&(d=d.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(d)))throw q;if(l=this.children[d],!l){if(Object.keys(this.children).some(v=>v!==U&&v!==W))throw q;if(i)return;l=this.children[d]=new ae,h!==""&&(l.varIndex=n.varIndex++)}!i&&h!==""&&s.push([h,l.varIndex])}else if(l=this.children[a],!l){if(Object.keys(this.children).some(h=>h.length>1&&h!==U&&h!==W))throw q;if(i)return;l=this.children[a]=new ae}l.insert(c,r,s,n,i)}buildRegExpStr(){const r=Object.keys(this.children).sort(Rt).map(s=>{const n=this.children[s];return(typeof n.varIndex=="number"?`(${s})@${n.varIndex}`:Et.has(s)?`\\${s}`:s)+n.buildRegExpStr()});return typeof this.index=="number"&&r.unshift(`#${this.index}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},St=class{constructor(){u(this,"context",{varIndex:0});u(this,"root",new ae)}insert(e,t,r){const s=[],n=[];for(let a=0;;){let c=!1;if(e=e.replace(/\{[^}]+\}/g,o=>{const l=`@\\${a}`;return n[a]=[l,o],a++,c=!0,l}),!c)break}const i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=n.length-1;a>=0;a--){const[c]=n[a];for(let o=i.length-1;o>=0;o--)if(i[o].indexOf(c)!==-1){i[o]=i[o].replace(c,n[a][1]);break}}return this.root.insert(i,t,s,this.context,r),s}buildRegExp(){let e=this.root.buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,a)=>typeof i<"u"?(r[++t]=Number(i),"$()"):(typeof a<"u"&&(s[Number(a)]=++t),"")),[new RegExp(`^${e}`),r,s]}},Pe=[],jt=[/^$/,[],Object.create(null)],Z=Object.create(null);function _e(e){return Z[e]??(Z[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Ot(){Z=Object.create(null)}function $t(e){var l;const t=new St,r=[];if(e.length===0)return jt;const s=e.map(h=>[!/\*|\/:/.test(h[0]),...h]).sort(([h,d],[v,$])=>h?1:v?-1:d.length-$.length),n=Object.create(null);for(let h=0,d=-1,v=s.length;h<v;h++){const[$,m,b]=s[h];$?n[m]=[b.map(([j])=>[j,Object.create(null)]),Pe]:d++;let x;try{x=t.insert(m,d,$)}catch(j){throw j===q?new Te(m):j}$||(r[d]=b.map(([j,C])=>{const T=Object.create(null);for(C-=1;C>=0;C--){const[V,K]=x[C];T[V]=K}return[j,T]}))}const[i,a,c]=t.buildRegExp();for(let h=0,d=r.length;h<d;h++)for(let v=0,$=r[h].length;v<$;v++){const m=(l=r[h][v])==null?void 0:l[1];if(!m)continue;const b=Object.keys(m);for(let x=0,j=b.length;x<j;x++)m[b[x]]=c[m[b[x]]]}const o=[];for(const h in a)o[h]=r[a[h]];return[i,o,n]}function I(e,t){if(e){for(const r of Object.keys(e).sort((s,n)=>n.length-s.length))if(_e(r).test(t))return[...e[r]]}}var Tt=class{constructor(){u(this,"name","RegExpRouter");u(this,"middleware");u(this,"routes");this.middleware={[w]:Object.create(null)},this.routes={[w]:Object.create(null)}}add(e,t,r){var c;const{middleware:s,routes:n}=this;if(!s||!n)throw new Error($e);s[e]||[s,n].forEach(o=>{o[e]=Object.create(null),Object.keys(o[w]).forEach(l=>{o[e][l]=[...o[w][l]]})}),t==="/*"&&(t="*");const i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const o=_e(t);e===w?Object.keys(s).forEach(l=>{var h;(h=s[l])[t]||(h[t]=I(s[l],t)||I(s[w],t)||[])}):(c=s[e])[t]||(c[t]=I(s[e],t)||I(s[w],t)||[]),Object.keys(s).forEach(l=>{(e===w||e===l)&&Object.keys(s[l]).forEach(h=>{o.test(h)&&s[l][h].push([r,i])})}),Object.keys(n).forEach(l=>{(e===w||e===l)&&Object.keys(n[l]).forEach(h=>o.test(h)&&n[l][h].push([r,i]))});return}const a=Se(t)||[t];for(let o=0,l=a.length;o<l;o++){const h=a[o];Object.keys(n).forEach(d=>{var v;(e===w||e===d)&&((v=n[d])[h]||(v[h]=[...I(s[d],h)||I(s[w],h)||[]]),n[d][h].push([r,i-l+o+1]))})}}match(e,t){Ot();const r=this.buildAllMatchers();return this.match=(s,n)=>{const i=r[s]||r[w],a=i[2][n];if(a)return a;const c=n.match(i[0]);if(!c)return[[],Pe];const o=c.indexOf("",1);return[i[1][o],c]},this.match(e,t)}buildAllMatchers(){const e=Object.create(null);return[...Object.keys(this.routes),...Object.keys(this.middleware)].forEach(t=>{e[t]||(e[t]=this.buildMatcher(t))}),this.middleware=this.routes=void 0,e}buildMatcher(e){const t=[];let r=e===w;return[this.middleware,this.routes].forEach(s=>{const n=s[e]?Object.keys(s[e]).map(i=>[i,s[e][i]]):[];n.length!==0?(r||(r=!0),t.push(...n)):e!==w&&t.push(...Object.keys(s[w]).map(i=>[i,s[w][i]]))}),r?$t(t):null}},At=class{constructor(e){u(this,"name","SmartRouter");u(this,"routers",[]);u(this,"routes",[]);Object.assign(this,e)}add(e,t,r){if(!this.routes)throw new Error($e);this.routes.push([e,t,r])}match(e,t){if(!this.routes)throw new Error("Fatal error");const{routers:r,routes:s}=this,n=r.length;let i=0,a;for(;i<n;i++){const c=r[i];try{s.forEach(o=>{c.add(...o)}),a=c.match(e,t)}catch(o){if(o instanceof Te)continue;throw o}this.match=c.match.bind(c),this.routers=[c],this.routes=void 0;break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(this.routes||this.routers.length!==1)throw new Error("No active router has been determined yet.");return this.routers[0]}},Ce=class{constructor(e,t,r){u(this,"methods");u(this,"children");u(this,"patterns");u(this,"order",0);u(this,"name");u(this,"params",Object.create(null));if(this.children=r||Object.create(null),this.methods=[],this.name="",e&&t){const s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0,name:this.name},this.methods=[s]}this.patterns=[]}insert(e,t,r){this.name=`${e} ${t}`,this.order=++this.order;let s=this;const n=ut(t),i=[];for(let o=0,l=n.length;o<l;o++){const h=n[o];if(Object.keys(s.children).includes(h)){s=s.children[h];const v=pe(h);v&&i.push(v[1]);continue}s.children[h]=new Ce;const d=pe(h);d&&(s.patterns.push(d),i.push(d[1])),s=s.children[h]}s.methods.length||(s.methods=[]);const a=Object.create(null),c={handler:r,possibleKeys:i.filter((o,l,h)=>h.indexOf(o)===l),name:this.name,score:this.order};return a[e]=c,s.methods.push(a),s}gHSets(e,t,r,s){const n=[];for(let i=0,a=e.methods.length;i<a;i++){const c=e.methods[i],o=c[t]||c[w],l=Object.create(null);o!==void 0&&(o.params=Object.create(null),o.possibleKeys.forEach(h=>{const d=l[o.name];o.params[h]=s[h]&&!d?s[h]:r[h]??s[h],l[o.name]=!0}),n.push(o))}return n}search(e,t){const r=[];this.params=Object.create(null);let n=[this];const i=Re(t);for(let c=0,o=i.length;c<o;c++){const l=i[c],h=c===o-1,d=[];for(let v=0,$=n.length;v<$;v++){const m=n[v],b=m.children[l];b&&(b.params=m.params,h===!0?(b.children["*"]&&r.push(...this.gHSets(b.children["*"],e,m.params,Object.create(null))),r.push(...this.gHSets(b,e,m.params,Object.create(null)))):d.push(b));for(let x=0,j=m.patterns.length;x<j;x++){const C=m.patterns[x],T={...m.params};if(C==="*"){const ee=m.children["*"];ee&&(r.push(...this.gHSets(ee,e,m.params,Object.create(null))),d.push(ee));continue}if(l==="")continue;const[V,K,k]=C,D=m.children[V],he=i.slice(c).join("/");if(k instanceof RegExp&&k.test(he)){T[K]=he,r.push(...this.gHSets(D,e,m.params,T));continue}(k===!0||k instanceof RegExp&&k.test(l))&&typeof V=="string"&&(T[K]=l,h===!0?(r.push(...this.gHSets(D,e,T,m.params)),D.children["*"]&&r.push(...this.gHSets(D.children["*"],e,T,m.params))):(D.params=T,d.push(D)))}}n=d}return[r.sort((c,o)=>c.score-o.score).map(({handler:c,params:o})=>[c,o])]}},Pt=class{constructor(){u(this,"name","TrieRouter");u(this,"node");this.node=new Ce}add(e,t,r){const s=Se(t);if(s){for(const n of s)this.node.insert(e,n,r);return}this.node.insert(e,t,r)}match(e,t){return this.node.search(e,t)}},Ne=class extends Ae{constructor(e={}){super(e),this.router=e.router??new At({routers:[new Tt,new Pt]})}};new TextEncoder;var _t=Ze(null),Ct=(e,t,r,s)=>(n,i)=>{const a="<!DOCTYPE html>",c=r?fe(l=>r(l,e),{Layout:t,...i},n):n,o=ze`${M(a)}${fe(_t.Provider,{value:e},c)}`;return e.html(o)},Nt=(e,t)=>function(s,n){const i=s.getLayout()??nt;return e&&s.setLayout(a=>e({...a,Layout:i},s)),s.setRenderer(Ct(s,i,e)),n()};const Ht=Nt(({children:e,title:t})=>N("html",{children:[N("head",{children:[N("link",{href:"/static/style.css",rel:"stylesheet"}),N("title",{children:t})]}),N("body",{children:e})]}));var Ft=async e=>await He(e,{name:"SHA-1",alias:"sha1"}),He=async(e,t)=>{let r;if(e instanceof ReadableStream){let s="";const n=e.getReader();return await(n==null?void 0:n.read().then(async i=>{const a=await He(i.value||"",t);s+=a})),s}if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer?r=e:(typeof e=="object"&&(e=JSON.stringify(e)),r=new TextEncoder().encode(String(e))),crypto&&crypto.subtle){const s=await crypto.subtle.digest({name:t.name},r);return Array.prototype.map.call(new Uint8Array(s),i=>("00"+i.toString(16)).slice(-2)).join("")}return null},Dt=["cache-control","content-location","date","etag","expires","vary"];function It(e,t){return t!=null&&t.split(/,\s*/).indexOf(e)>-1}var Bt=e=>{const t=Dt;return async function(s,n){const i=s.req.header("If-None-Match")??null;await n();const a=s.res;let c=a.headers.get("ETag");c||(c=`"${await Ft(a.clone().body||"")}"`),It(c,i)?(await s.res.blob(),s.res=new Response(null,{status:304,statusText:"Not Modified",headers:{ETag:c}}),s.res.headers.forEach((o,l)=>{t.indexOf(l.toLowerCase())===-1&&s.res.headers.delete(l)})):s.res.headers.set("ETag",c)}};function Lt(){const{process:e,Deno:t}=globalThis;return!(typeof e<"u"?"NO_COLOR"in(e==null?void 0:e.env):typeof(t==null?void 0:t.noColor)=="boolean"?t.noColor:!1)}var Mt=e=>{const[t,r]=[",","."];return e.map(n=>n.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+t)).join(r)},kt=e=>{const t=Date.now()-e;return Mt([t<1e3?t+"ms":Math.round(t/1e3)+"s"])},zt=e=>{const t=Lt(),r={7:t?`\x1B[35m${e}\x1B[0m`:`${e}`,5:t?`\x1B[31m${e}\x1B[0m`:`${e}`,4:t?`\x1B[33m${e}\x1B[0m`:`${e}`,3:t?`\x1B[36m${e}\x1B[0m`:`${e}`,2:t?`\x1B[32m${e}\x1B[0m`:`${e}`,1:t?`\x1B[32m${e}\x1B[0m`:`${e}`,0:t?`\x1B[33m${e}\x1B[0m`:`${e}`},s=e/100|0;return r[s]};function me(e,t,r,s,n=0,i){const a=t==="<--"?`  ${t} ${r} ${s}`:`  ${t} ${r} ${s} ${zt(n)} ${i}`;e(a)}var qt=(e=console.log)=>async function(r,s){const{method:n}=r.req,i=le(r.req.raw);me(e,"<--",n,i);const a=Date.now();await s(),me(e,"-->",n,i,r.res.status,kt(a))},Ut=e=>{let t=e.filename;const r=e.defaultDocument||"index.html";return t.endsWith("/")?t=t.concat(r):t.match(/\.[a-zA-Z0-9_-]+$/)||(t=t.concat("/"+r)),Fe({root:e.root,filename:t})},Fe=e=>{let t=e.root||"",r=e.filename;if(/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(r))return;r=r.replace(/^\.?[\/\\]/,""),r=r.replace(/\\/,"/"),t=t.replace(/\/$/,"");let s=t?t+"/"+r:r;return s=s.replace(/^\.?\//,""),s},ne=(e,t=Wt)=>{const r=/\.([a-zA-Z0-9]+?)$/,s=e.match(r);if(!s)return;let n=t[s[1]];return(n&&n.startsWith("text")||n==="application/json")&&(n+="; charset=utf-8"),n},Wt={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},Vt="index.html",Kt=e=>e,Jt=e=>async(t,r)=>{var l;if(t.finalized){await r();return}let s=e.path??decodeURI(t.req.path);s=e.rewriteRequestPath?e.rewriteRequestPath(s):s;const n=e.root;let i=Ut({filename:s,root:n,defaultDocument:Vt});if(!i)return await r();const a=e.getContent,c=e.pathResolve??Kt;i=c(i);let o=await a(i,t);if(!o){let h=Fe({filename:s,root:n});if(!h)return await r();h=c(h),h!==i&&(o=await a(h,t),o&&(i=h))}if(o instanceof Response)return t.newResponse(o.body,o);if(o){let h;return e.mimes?h=ne(i,e.mimes)??ne(i):h=ne(i),h&&t.header("Content-Type",h),t.body(o)}await((l=e.onNotFound)==null?void 0:l.call(e,i,t)),await r()},Xt=async(e,t)=>{let r;t&&t.manifest?typeof t.manifest=="string"?r=JSON.parse(t.manifest):r=t.manifest:typeof __STATIC_CONTENT_MANIFEST=="string"?r=JSON.parse(__STATIC_CONTENT_MANIFEST):r=__STATIC_CONTENT_MANIFEST;let s;t&&t.namespace?s=t.namespace:s=__STATIC_CONTENT;const n=r[e]||e;if(!n)return null;const i=await s.get(n,{type:"stream"});return i||null},Gt=e=>async function(r,s){return Jt({...e,getContent:async i=>Xt(i,{manifest:e.manifest,namespace:e.namespace?e.namespace:r.env?r.env.__STATIC_CONTENT:void 0})})(r,s)},Zt=e=>Gt(e);const F=new Ne;F.use(Bt(),qt());F.use("/static/*",Zt({root:"./",manifest:{"/static/style.css":"/static/style.css"}}));F.get("/page/*",Ht);F.get("/page/about",e=>e.render(N("h1",{children:"About me!"})));F.get("/page/me",e=>e.render(N("h1",{children:"my home!"})));F.get("/",e=>e.html("<h1>Hello! Hono!</h1>"));var De=()=>async e=>{const r=await e.env.ASSETS.fetch(e.req.raw);return r.status===404?e.notFound():r};const Y=new Ne;Y.get("/favicon.ico",De());Y.get("/static/*",De());const Qt=Object.assign({"/src/index.tsx":F});let Ie=!1;for(const[,e]of Object.entries(Qt))e&&(Y.route("/",e),Y.notFound(e.notFoundHandler),Ie=!0);if(!Ie)throw new Error("Can't import modules from ['/src/index.tsx','/app/server.ts']");export{Y as default};
